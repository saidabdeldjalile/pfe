<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>Liste des réunions</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
    <style>
        .navbar-custom {
            background-color: red; /* Rouge */
            position: fixed; /* Fixer la navbar en haut */
            width: 100%; /* Largeur de la navbar sur toute la page */
            z-index: 1000; /* Assurer que la navbar est au-dessus des autres éléments */
        }
        .navbar-custom .navbar-brand {
            color: white; /* Texte blanc */
        }
        .navbar-custom .nav-link {
            color: white; /* Texte blanc */
        }
        .navbar-custom .nav-item form {
            display: inline;
        }
        .navbar-custom .nav-item i {
            color: white; /* Icône en blanc */
        }
        .leftbar {
            background-color: red; /* Rouge */
            color: white; /* Texte blanc */
            position: fixed; /* Fixer le sidebar */
            height: 100%; /* Hauteur sur toute la page */
            width: 250px; /* Largeur du sidebar */
            padding-top: 60px; /* Ajouter un espace pour la navbar */
            top: 0; /* Aligner en haut */
            left: 0; /* Aligner à gauche */
        }
        .leftbar ul {
            list-style: none; /* Supprimer les puces des listes */
            padding-left: 0; /* Retirer le padding de gauche */
        }
        .leftbar ul li {
            padding: 8px 16px; /* Espacement des éléments de la liste */
        }
        .leftbar ul li a {
            color: white; /* Texte blanc pour les liens */
        }
        .content {
            margin-left: 250px; /* Marge à gauche pour le contenu pour laisser de l'espace pour le sidebar */
            padding: 20px; /* Espacement du contenu */
            padding-top: 80px; /* Espacement pour la navbar */
        }
    </style>
</h:head>


<h:body>
    <!-- Barre de navigation -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <a class="navbar-brand" href="#">AIR ALGERIE</a>
        <h:form>
            <p:commandButton value="Filtrer Réunions" onclick="PF('filterDialog').show()" styleClass="btn btn-primary btn-custom" />
            <h:link outcome="login.xhtml" value="Déconnecter" styleClass="btn btn-primary ml-auto"/>
               <p:commandButton value="Ajouter Réunion" onclick="PF('addDialog').show()" styleClass="btn btn-primary btn-custom" />
            
        </h:form>
    </nav>
    <!-- Sidebar (leftbar) -->
    <div class="leftbar">
        <!-- Contenu de la barre de navigation -->
        <ul class="nav flex-column">
            <!-- Lien pour l'admin -->
            <ui:fragment rendered="#{request.isUserInRole('admin')}">
                <li class="nav-item">
                    <a class="nav-link" href="admin.xhtml">Admin</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="Employe.xhtml">Gerer Employe</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="users.xhtml">Gerer User</a>
                </li>
            </ui:fragment>
            <!-- Lien pour l'utilisateur -->
            <ui:fragment rendered="#{request.isUserInRole('user')}">
                <li class="nav-item">
                    <a class="nav-link" href="user.xhtml">User</a>
                </li>
            </ui:fragment>
            <!-- Lien pour le manager -->
            <ui:fragment rendered="#{request.isUserInRole('manager')}">
                <li class="nav-item">
                    <a class="nav-link" href="manager.xhtml">Manager</a>
                </li>
            </ui:fragment>
            <!-- Lien pour tous les utilisateurs -->
            <li class="nav-item">
                <a class="nav-link" href="#">Paramètres</a>
            </li>
        </ul>
    </div>


<!-- Sidebar (leftbar) -->

<p:dialog header="Ajouter une réunion" widgetVar="addDialog" resizable="false" modal="true">
    <h:form id="addDialogForm">
        <h:panelGrid columns="2">
            <h:outputLabel for="newIdInput" value="ID:" />
            <h:inputText id="newIdInput" value="#{reunionBean.reunion.id}" />

            <h:outputLabel for="newDateDebInput" value="Date de début:" />
            <p:calendar id="newDateDebInput" value="#{reunionBean.reunion.dateDeb}" showButtonPanel="true" pattern="MM/dd/yyyy HH:mm:ss" />

            <p:outputLabel for="timeonly" value="Durée" />
            <p:calendar id="timeonly" value="#{reunionBean.reunion.duree}" timeOnly="true" pattern="HH:mm" />

            <h:outputLabel for="newTitreInput" value="Titre:" />
            <h:inputText id="newTitreInput" value="#{reunionBean.reunion.titre}" />

            <h:outputLabel for="newDetailleInput" value="Détails:" />
            <h:inputTextarea id="newDetailleInput" value="#{reunionBean.reunion.detaille}" />

            <h:outputLabel for="selectedEmployees" value="Sélectionner les employés:" />
            <p:selectCheckboxMenu id="selectedEmployees" value="#{reunionBean.selectedEmployees}" 
                                   label="Sélectionner les employés" 
                                   filter="true" filterMatchMode="contains">
                <f:selectItems value="#{reunionBean.allEmployees}" var="emp" itemLabel="#{emp.nom} #{emp.prenom}" itemValue="#{emp}"/>
            </p:selectCheckboxMenu>

            <p:fileUpload listener="#{reunionBean.handleFileUpload}" dragDropSupport="false"
                          update="messages" allowTypes="/(\.|\/)(pdf)$/" auto="true" />
            <p:growl id="messages" showDetail="true" />

        </h:panelGrid>
        <p:commandButton value="Ajouter" action="#{reunionBean.ajouterReunion}" oncomplete="if (!args.validationFailed) PF('addDialog').hide()" update="addDialogForm"/>
    </h:form>
</p:dialog>



    <div class="content">
        <h:form id="tableForm">
            <div class="table-wrapper">
                <p:dataTable value="#{reunionBean.reunions}" var="reunion" id="tableReunions" styleClass="table table-bordered table-striped"
                             filteredValue="#{reunionBean.filteredReunions}">
                    <p:column headerText="ID" filterBy="#{reunion.id}" filterMatchMode="contains">#{reunion.id}</p:column>
                    <p:column headerText="Date de début" filterBy="#{reunion.dateDeb}" filterMatchMode="contains">#{reunion.dateDeb}</p:column>
                    <p:column headerText="Durée" filterBy="#{reunion.duree}" filterMatchMode="contains">#{reunion.duree}</p:column>
                    <p:column headerText="Titre" filterBy="#{reunion.titre}" filterMatchMode="contains">#{reunion.titre}</p:column>
                    <p:column headerText="Détails" filterBy="#{reunion.detaille}" filterMatchMode="contains">#{reunion.detaille}</p:column>
                    <p:column headerText="Employés">
                        <ui:repeat value="#{reunion.gestionreunion}" var="employee">
                            <li> #{employee.nom} #{employee.prenom}</li>
                        </ui:repeat>
                    </p:column>
                    <p:column headerText="Actions">
                        <p:commandButton value="Modifier" oncomplete="PF('modifyDialog').show()" update=":modifyForm">
                            <f:setPropertyActionListener target="#{reunionBean.reunionAModifier}" value="#{reunion}" />
                        </p:commandButton>
                        <p:commandButton value="Supprimer" action="#{reunionBean.supprimerReunion(reunion)}" update=":tableForm" >
                            <p:confirm header="Confirmation" message="Are you sure you want to proceed?" icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </p:column>
                    <p:column headerText="Fichiers">
                        <p:commandButton value="Voir les fichiers" actionListener="#{reunionBean.loadFilesForReunion(reunion.id)}" oncomplete="PF('fileDialog').show();" update=":files"/>
                    </p:column>
                </p:dataTable>
            </div>
        </h:form>
    </div>
  
<p:dialog header="Filtrer par date" widgetVar="filterDialog" resizable="false" modal="true">
    <h:form id="filterDialogForm">
        <p:panelGrid columns="2" columnClasses="ui-grid-col-4,ui-grid-col-8" layout="grid">
            <p:row>
                <p:outputLabel for="startDate" value="Date de début:" />
                <p:calendar id="startDate" value="#{reunionBean.dateDebutFilter}" showButtonPanel="true" pattern="MM/dd/yyyy HH:mm:ss" />
            </p:row>
            <p:row>
                <p:outputLabel for="endDate" value="Date de fin:" />
                <p:calendar id="endDate" value="#{reunionBean.dateFinFilter}" showButtonPanel="true" pattern="MM/dd/yyyy HH:mm:ss" />
            </p:row>
        </p:panelGrid>
        <p:commandButton value="Filtrer" action="#{reunionBean.filtrerParDate}" oncomplete="PF('filterDialog').hide()" update=":tableForm" />
    </h:form>
</p:dialog>
<p:dialog header="Modifier la réunion" widgetVar="modifyDialog" resizable="false" modal="true">
    <h:form id="modifyForm">
        <h:panelGrid columns="2">
            <h:outputLabel for="idInput" value="ID:" />
            <h:inputText id="idInput" value="#{reunionBean.reunionAModifier.id}" />
              
            <h:outputLabel for="DateDebInput" value="Date de début:" />
            <p:calendar id="DateDebInput" value="#{reunionBean.reunionAModifier.dateDeb}" showButtonPanel="true" pattern="MM/dd/yyyy HH:mm:ss" />

            <p:outputLabel for="timeonly" value="Durée" />
            <p:calendar id="timeonly" value="#{reunionBean.reunionAModifier.duree}" timeOnly="true" pattern="HH:mm" />

            <h:outputLabel for="titreInput" value="Titre:" />
            <h:inputText id="titreInput" value="#{reunionBean.reunionAModifier.titre}" />

            <h:outputLabel for="detailleInput" value="Détails:" />
            <h:inputTextarea id="detailleInput" value="#{reunionBean.reunionAModifier.detaille}" />
            
            <h:outputLabel value="Employés sélectionnés:" />
            <p:selectCheckboxMenu value="#{reunionBean.selectedEmployees}" label="Sélectionner les employés" 
                                   filter="true" filterMatchMode="contains">
                <f:selectItems value="#{reunionBean.allEmployees}" var="emp" itemLabel="#{emp.nom} #{emp.prenom}" itemValue="#{emp}"/>
            </p:selectCheckboxMenu>
        </h:panelGrid>
        <p:commandButton value="Confirmer Modification" action="#{reunionBean.modifierReunion}" oncomplete="PF('modifyDialog').hide()" update=":tableForm" />
    </h:form>
</p:dialog>

<p:dialog id="files" header="Fichiers de la Réunion" widgetVar="fileDialog" resizable="true" modal="true" width="600">
    <h:form id="fileDialogForm">
        <!-- Ajout du composant d'upload de fichiers -->
      
        <!-- Tableau affichant les fichiers actuellement associés à la réunion -->
        <p:dataTable value="#{reunionBean.selectedReunionFiles}" var="file" id="fileTable" emptyMessage="Aucun fichier trouvé">
            <p:column headerText="Nom de fichier">
                <h:outputText value="#{file.name}" />
                <p:commandButton value="Afficher PDF" action="#{reunionBean.afficherPDF(file.name)}" />
                <p:commandButton value="Supprimer" action="#{reunionBean.supprimerFichier(file.name)}" update="@form">
                    <p:confirm header="Confirmation" message="Êtes-vous sûr de vouloir supprimer ce fichier ?" icon="pi pi-exclamation-triangle"/>
                </p:commandButton>
            </p:column>
            
        </p:dataTable>
          <p:fileUpload listener="#{reunionBean.handleFileUploadForModifiedReunion}" dragDropSupport="false"
                          update="messages" allowTypes="/(\.|\/)(pdf)$/" auto="true" />
            <p:growl id="messages" showDetail="true" />

 <p:commandButton value="Ajouter" action="#{reunionBean.ajouterFichiersAReunion(reunionBean.selectedReunionId, reunionBean.filesForModifiedReunion)}" update="fileDialogForm"/>
    </h:form>
</p:dialog>


<p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-flat"   />
    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" />
</p:confirmDialog>



</h:body>
</html>
