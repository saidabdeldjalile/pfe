<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template/common/commonSimpleLayout.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:cc="http://java.sun.com/jsf/composite/component"
                xmlns:ct="http://airalgerie.dz/facelets"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:of="http://omnifaces.org/functions">

    <ui:define name="stylesTop">
    </ui:define>

    <ui:define name="titlePage">
        <title>ERP - Gestion des Permissions</title>
    </ui:define>


    <ui:define name="pageTitle">
        <h3 class="m-a-2">Gestion des Permissions</h3>
    </ui:define>

    <ui:define name="content">

        <h:form id="contentForm">

            <div class="row m-b-2">
                <!--add btn-->
                <b:column col-sm="3" col-md="3" styleClass="pull-right" rendered="#{request.isUserInRole('refAdminPermissionAdd')}">
                   <ct:link id="addBtn"
                             styleClass="btn-success btn-block"
                             icon="fa-plus"
                             value="Ajouter une permission"
                             update=":addPermission"
                             action="#{permissionBean.resetAdd()}"
                             onComplete="PF('addPermission').show();"
                             process="@this">
                    </ct:link>
                </b:column>
            </div>

            <b:row id="permissionsAlert" >
                <cc:alert alert="#{permissionBean.alertBean.alerts}" />
            </b:row>

            <ct:dataTable value="#{permissionBean.permissionModel}"
                          id="permissionsList"
                          rendered="#{permissionBean.permissionModel ne null}"
                          >

                <p:column headerText="#ID" filterBy="#{item.id}" sortBy="#{item.id}" style="text-align: center" width="100">
                    <h:outputText value="#{item.id}"/>
                </p:column>
                <p:column headerText="#ID Fonction" filterBy="#{item.refFonction.id}" sortBy="#{item.refFonction.id}" style="text-align: center" width="120">
                    <h:outputText value="#{item.idFonction}"/>
                </p:column>
                <p:column headerText="Code Fonction" filterBy="#{item.refFonction.code}" sortBy="#{item.refFonction.code}" style="text-align: center" width="120">
                    <h:outputText value="#{item.codeFonction}"/>
                </p:column>
                <p:column headerText="Nom" filterBy="#{item.name}" sortBy="#{item.name}" style="text-align: center" width="250">
                    <h:outputText value="#{item.nom}"/>
                </p:column>
                <p:column headerText="Description" filterBy="#{item.description}" sortBy="#{item.description}" style="text-align: center" width="300">
                    <h:outputText value="#{item.description}"/>
                </p:column>

                <p:column headerText="Statut" width="130" styleClass="text-center"
                          filterBy="#{item.viewAccess}" sortBy="#{item.viewAccess}" >
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('permissionsList').filter()" styleClass="custom-filter">
                            <f:selectItem itemLabel="Filtrer..." itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItem itemLabel="View(s)" itemValue="#{1}" />
                            <f:selectItem itemLabel="Non View(s)" itemValue="#{0}" />
                        </p:selectOneMenu>
                    </f:facet>
                    <b:label text="#{item.viewAccess ? 'view' : 'non view'}" 
                             severity="#{item.viewAccess ? 'success' : 'danger'}"
                             styleClass="label-outline label-pill"
                             />
                </p:column>


                <p:column headerText="Actions" width="120" style="text-align: center" rendered="#{request.isUserInRole('refAdminPermissionAdd')}">
                    <b:commandButton look="info" styleClass="btn-small-square" iconAwesome="edit"
                                     tooltip="Editer" action="#{permissionBean.resetEdit()}"
                                     oncomplete="PF('addPermission').show(); loadingHide();" 
                                     update=":addPermission :dataPermission">
                        <f:setPropertyActionListener target="#{permissionBean.selectedPermission}" value="#{item}"/>
                    </b:commandButton>
                    &nbsp;
                    <b:commandButton ajax="true" look="danger" styleClass="btn-small-square" iconAwesome="trash"
                                     tooltip="Supprimer"
                                     oncomplete="$('.delete-permission').modal(); loadingHide();" >
                        <f:setPropertyActionListener target="#{permissionBean.selectedPermission}" value="#{item}"/>
                    </b:commandButton>

                </p:column>

            </ct:dataTable>
        </h:form>

        <ct:dialog id="addPermission" 
                   headerTitle="#{permissionBean.editMode ? 'Modification' : 'Ajout'} d'une permission"
                   saveBtnRendred="true" height="450" saveBtnClass="addPermissionBtn" >
            <h:form id="dataPermission" rendered="#{request.isUserInRole('refAdminPermissionAdd')}">
                <ui:include src="includes/addPermission.xhtml" />
            </h:form>
        </ct:dialog>

        <ct:confirmDiag name="delete-permission" update=":contentForm"
                        actionListener="permissionBean.deletePermission()"
                        message="-vous sÃ»r de vouloir supprimer cette permission ?" />

    </ui:define>
</ui:composition>